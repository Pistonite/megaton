# Megaton Target Directory

## `<target>/megaton/`

Megaton places all of its build artifacts in the Megaton target directory.
The top level directory is usually `target/megaton/` (relative to project
root), but the name `target` can be customize in the Megaton configuration.

#### `<target>/megaton/<profile>/`
The Megaton target directory is divided up into subdirectories according to
profile. Each time a build is run for a new profile, a unique target dir will
be created for that profile. For example, a target directory might have a
separate debug and release directory.

---
For all following directories, assume they are relative to
`<target>/megaton/<profile>`.

### `compdb.cache`
The cached compilation database used by the build tool. This records every
command in the build process to keep track of what objects have been built
and what command was used to build them. This keeps track of the incremental
build for both the library and the module.

---
### `lib/`
This directory contains all sources and artifacts for the Megaton library.

#### `lib/include`
All header files that the megaton uses or exports are contained here. They are
split into three directories to control visibility.

- `lib/include/megaton`: Public headers. Used like this: `#include
<megaton/example.h>`

- `lib/include/__priv`: Private headers. These are not intended to be used
directly by mod code, but they may be included by public headers.

- `lib/include/__internal`: Internal headers. Only needed for compiling the
libmegaton source. These headers should be invisible to library users.

#### `lib/src`
Contains all the C/C++/S/RS sources. Cargo will compile the rust sources as a 
rust dependency when building rust code for the mod. The build tool will
directly build everything else with gcc/g++. This directory also contains
external code like libnx.

#### `lib/rt`
Linker scripts and libmegaton runtime code. Specifically, this will contain 
`megamain.c` which handles the Megaton entry point, and `link.ld`, which is 
needed for linking the mod elf.

#### `lib/Cargo.toml`
The Cargo manifest for the rust part of the megaton library. Megaton doesn't
manage this directly. Cargo will use this when building the mod and the rust
part of the library as a dependency.

#### `lib/o`
The C(++) objects for the library. They will be stored here and reused for 
incremental builds by the megaton build tool. When the mod is linked, the build
tool will reference this directly to find all libmegaton artifacts.

---

### `<module>/`
This directory contains all of the build files for the built module. This
directory will have the same name as the generated elf/nso. It also contains
the main output artifacts generated by the build tool in the top level. These
include `<module>.elf`, `<module>.nso`, `verfile`, and `npdm.json`.

#### `<module>/include/`
Contains all generated headers needed to build the mod.

- `<module>/include/cxxbridge`: Headers generated by the cxxbridge tool.

#### `<module>/src/`
Contains all generated sources needed to build the mod.

- `<module>/src/cxxbridge`: Sources generated by the cxxbridge tool.

#### `<module>/o/`
Contains all the C(++) object files and dependency files. Used to
incrementally build the mod.

#### `<module>.elf`
The elf created by linking the mod, library, and rust staticlib. This is not
the final binary that will be loaded by the switch.

#### `<module>.nso`
This is the binary that the switch will load when loading the mod. It is
created by converting the mod elf to an nso file.
