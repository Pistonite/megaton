# Megaton Target Directory

## `<target>/megaton/`

Megaton places all of its build artifacts in the Megaton target directory.
The top level directory is usually `target/megaton/` (relative to project
root), but the name `target` can be customize in the Megaton configuration.

#### `<target>/megaton/<profile>/`
The Megaton target directory is divided up into subdirectories according to
profile. Each time a build is run for a new profile, a unique target dir will
be created for that profile. For example, a target directory might have a
separate debug and release directory.

---
For all following directories, assume they are relative to
`<target>/megaton/<profile>`.

### `compdb.cache`
The cached compilation database used by the build tool. This records every
command in the build process to keep track of what objects have been built
and what command was used to build them. This keeps track of the incremental
build for both the library and the module.

---
### `lib/`
This directory contains all sources and artifacts for the Megaton library.

#### `lib/include/megaton`
All header files that the megaton uses or exports are contained here.
Headers in the top level direcotry are public and can be included in mod
source (`#include <megaton/example.h>`). Besides the top level directory,
there are two subdirectories to control visibility.

- `lib/include/megaton/__priv`: Private headers. These are not intended to be
used directly by mod code, but they may be included by public headers.

- `lib/include/megaton/__internal`: Internal headers. Only needed for compiling
the libmegaton source. These headers should be invisible to library users.

#### `lib/src`
Contains all the C/C++/S/RS sources. Cargo will compile the rust sources as a
rust dependency when building rust code for the mod. The build tool will
directly build everything else with gcc/g++, including library code like
megamain.c and external code like libnx.

#### `lib/link.ld`
The linker script needed to correctly link to the mod into an elf that can be
converted into a switch-recognizable .nso file.

#### `lib/Cargo.toml`
The Cargo manifest for the rust part of the megaton library. Megaton doesn't
manage this directly. Cargo will use this when building the mod and the rust
part of the library as a dependency.

---

### `<module>/`
This directory contains all of the build files for the built module. This
directory will have the same name as the generated elf/nso. It also contains
the main output artifacts generated by the build tool in the top level.

#### `<module>/include/`
Contains all generated headers needed to build the mod.

- `<module>/include/cxxbridge`: Headers generated by the cxxbridge tool.

#### `<module>/src/`
Contains all generated sources needed to build the mod.

- `<module>/src/cxxbridge`: Sources generated by the cxxbridge tool.

#### `<module>/o/`
Contains all the C(++) object files and dependency files compiled from the mod
and the library source. Used to incrementally build the mod. Library objects
are also placed here since they depend on module-specific build configs.

#### `<module>.elf`
The elf created by linking the mod, library, and rust staticlib. This is not
the final binary that will be loaded by the switch.

#### `<module>.nso`
This is the binary that the switch will load when loading the mod. It is
created by converting the mod elf to an nso file.

#### `npdm.json`
The data file needed needed for setting file permissions to properly load the
mod onto the switch.

#### `verfile`
Sets the entry point for the mod, needed by the linker.

